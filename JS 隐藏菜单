document.addEventListener('DOMContentLoaded', () => {
  const header = document.getElementById('masthead');
  const content = document.querySelector('main') || document.body;
  if (!header || !content) return;

  

  let isTouching = false;
  let lastY = 0;
  let scrollDistanceUp = 0;
  let isInertiaScrolling = false;
  let checkInertiaTimer = null;

  let lastScrollTop = window.pageYOffset;

  // ğŸ§  åˆ¤æ–­é¡µé¢æ˜¯å¦è¿˜åœ¨æƒ¯æ€§æ»šåŠ¨
  const monitorInertia = () => {
    if (checkInertiaTimer) clearInterval(checkInertiaTimer);
    let previous = window.pageYOffset;

    checkInertiaTimer = setInterval(() => {
      const current = window.pageYOffset;
      if (Math.abs(current - previous) < 1) {
        isInertiaScrolling = false;
        clearInterval(checkInertiaTimer);
      } else {
        isInertiaScrolling = true;
        previous = current;
      }
    }, 100);
  };

  // ğŸ‘‰ æ‰‹æŒ‡æŒ‰ä¸‹
  window.addEventListener('touchstart', (e) => {
    isTouching = true;
    scrollDistanceUp = 0;
    lastY = e.touches[0].clientY;

    // â—ä¸è¦åœ¨è¿™é‡Œé‡ç½®æƒ¯æ€§çŠ¶æ€ï¼Œé¡µé¢å¯èƒ½è¿˜åœ¨æƒ¯æ€§æ»‘åŠ¨
    // åªå¼€å¯æ£€æµ‹
    monitorInertia();
  }, { passive: true });

  // ğŸ‘‰ æ‰‹æŒ‡æ»‘åŠ¨
  window.addEventListener('touchmove', (e) => {
    if (!isTouching) return;

    const currentY = e.touches[0].clientY;
    const deltaY = currentY - lastY;

    if (deltaY > 0) {
      // â¬‡ï¸ å‘ä¸‹æ»‘åŠ¨ç«‹å³éšè—
      header.classList.add('hide-header');
      scrollDistanceUp = 0;
    } else if (deltaY < 0 && !isInertiaScrolling) {
      // â¬†ï¸ å‘ä¸Šæ»‘åŠ¨ï¼Œä¸”é¡µé¢é™æ­¢æ‰ç´¯ç§¯è·ç¦»
      scrollDistanceUp += -deltaY;
    }

    lastY = currentY;
  }, { passive: true });

  // ğŸ‘‰ æ‰‹æŒ‡æ¾å¼€
  window.addEventListener('touchend', () => {
    isTouching = false;

    if (window.pageYOffset <= 0) {
      header.classList.remove('hide-header'); // é¡¶éƒ¨å¼ºåˆ¶æ˜¾ç¤º
    } else if (!isInertiaScrolling && scrollDistanceUp > 50) {
      header.classList.remove('hide-header'); // å‘ä¸Šæ»‘åŠ¨æ¾æ‰‹ ä¸”éæƒ¯æ€§çŠ¶æ€
    }

    scrollDistanceUp = 0;
  });

  // ğŸ‘‰ æ¡Œé¢ç«¯æ»šåŠ¨ç›‘å¬
  window.addEventListener('scroll', () => {
    if (isTouching) return;

    const scrollTop = window.pageYOffset;
    const delta = scrollTop - lastScrollTop;

    monitorInertia(); // æ¯æ¬¡æ»šåŠ¨éƒ½æ£€æµ‹æƒ¯æ€§

    if (delta > 0) {
      header.classList.add('hide-header'); // å‘ä¸‹æ»šåŠ¨ â†’ éšè—
    } else if (delta < 0 && Math.abs(delta) > 30) {
      header.classList.remove('hide-header'); // å¿«é€Ÿå‘ä¸Š â†’ æ˜¾ç¤º
    }

    if (scrollTop <= 0) {
      header.classList.remove('hide-header'); // é¡¶éƒ¨å¼ºåˆ¶æ˜¾ç¤º
    }

    lastScrollTop = scrollTop;
  });
});
